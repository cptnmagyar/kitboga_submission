<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Kiss Your Dog!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DynaPuff:wght@400..700&display=swap" rel="stylesheet">
    <style type="text/css">
        html,
        body {
            background: black;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        * {
            user-select: none;
        }

        #captcha-container {
            width: 400px;
            height: 300px;
            background-image: url('dog_01.png');
            background-size: 400px 300px;
            overflow: hidden;
            display: flex;
            justify-content: stretch;
            align-items: stretch;
        }

        #captcha-container-inner {
            width: 100%;
            padding: 8px;
            margin: 8px;
        }

        #captcha-kiss-zone {
            width: 50px;
            height: 50px;
            padding: 8px;
            /* background color to display the kiss zone */
            /* background-color: rgba(0, 255, 255, 0.329); */
        }

        #final-round-dog-kiss {
            width: 250px;
            height: 300px;
            background-size: 250px 300px;
            background-repeat: no-repeat;
            background-image: url('dog_00.png');
            visibility: hidden;
            position: relative;
        }

        .custom-cursor-kiss-mark {
            cursor:url('kiss_mark_small.png') 25 15, auto;
        }

        .custom-cursor-kiss-pucker {
            cursor:url('kiss_pucker_small.png') 25 15, auto;
        }

        #title {
            text-align: center;
            font-size: 34px;
            background: rgb(50 50 50 / 0.3);
            font-family: "DynaPuff", system-ui;
            font-weight: 400;
            font-style: normal;
            color: white;
            text-shadow: 3px 3px 2px rgb(187, 138, 170);
        }
    </style>
</head>
<body>
<div id="captcha-container">
    <div id="captcha-container-inner">
        <div id="title">KISS YOUR DOG: 0/10</div>
        <div id="captcha-kiss-zone" onclick="kissTheDog();"></div>
        <div id="final-round-dog-kiss" onclick="finalKissTheDog();"></div>
    </div>
</div>
<script type="text/javascript">

    // Kissable Dog class for storing the kiss zone coordinates, kiss zone size, and dog image
    // Uncomment the #captcha-kiss-zone's background-color in CSS to see the dog's kiss zone
    class KissableDog {
        constructor(kissZoneXCoordinate, kissZoneYCoordinate, kissZoneWidth, kissZoneHeight, backgroundImage) {
            this.kissZoneXCoordinate = kissZoneXCoordinate;
            this.kissZoneYCoordinate = kissZoneYCoordinate;
            this.kissZoneWidth = kissZoneWidth;
            this.kissZoneHeight = kissZoneHeight;
            this.backgroundImage = backgroundImage;
        }
    }

    const dog01 = new KissableDog("145px", "40px", "40px", "25px", "url(dog_01.png)");
    const dog02 = new KissableDog("215px", "45px", "30px", "10px", "url(dog_02.png)");
    const dog03 = new KissableDog("70px", "50px", "40px", "15px", "url(dog_03.png)");
    const dog04 = new KissableDog("240px", "100px", "40px", "15px", "url(dog_04.png)");
    const dog05 = new KissableDog("200px", "60px", "30px", "15px", "url(dog_05.png)");
    const dog06 = new KissableDog("225px", "60px", "30px", "10px", "url(dog_06.png)");
    const dog07 = new KissableDog("180px", "100px", "35px", "15px", "url(dog_07.png)");
    const dog08 = new KissableDog("160px", "60px", "30px", "10px", "url(dog_08.png)");
    const dog09 = new KissableDog("140px", "50px", "35px", "15px", "url(dog_09.png)");
    const dog10 = new KissableDog("165px", "110px", "40px", "15px", "url(dog_10.png)");
    const dog11 = new KissableDog("215px", "45px", "25px", "10px", "url(dog_11.png)");
    const dog12 = new KissableDog("145px", "70px", "40px", "15px", "url(dog_12.png)");
    const dog13 = new KissableDog("145px", "40px", "40px", "15px", "url(dog_13.png)");
    const dog14 = new KissableDog("120px", "45px", "40px", "15px", "url(dog_14.png)");
    const dog15 = new KissableDog("150px", "70px", "40px", "15px", "url(dog_15.png)");
    const dog16 = new KissableDog("160px", "65px", "40px", "15px", "url(dog_16.png)");
    const dog17 = new KissableDog("120px", "80px", "30px", "15px", "url(dog_17.png)");
    const dog18 = new KissableDog("135px", "50px", "40px", "20px", "url(dog_18.png)");
    const dog19 = new KissableDog("100px", "45px", "35px", "20px", "url(dog_19.png)");
    const dog20 = new KissableDog("115px", "65px", "35px", "20px", "url(dog_20.png)");
    const dog21 = new KissableDog("225px", "45px", "35px", "20px", "url(dog_21.png)");
    const dog22 = new KissableDog("75px", "50px", "30px", "20px", "url(dog_22.png)");
    const dog23 = new KissableDog("175px", "40px", "35px", "20px", "url(dog_23.png)");
    const dog24 = new KissableDog("135px", "45px", "35px", "20px", "url(dog_24.png)");
    const dog25 = new KissableDog("170px", "85px", "35px", "20px", "url(dog_25.png)");
    const dog26 = new KissableDog("210px", "55px", "35px", "20px", "url(dog_26.png)");
    const dog27 = new KissableDog("170px", "95px", "30px", "15px", "url(dog_27.png)");
    const dog28 = new KissableDog("85px", "55px", "35px", "25px", "url(dog_28.png)");
    const dog29 = new KissableDog("272px", "65px", "40px", "25px", "url(dog_29.png)");
    const dog30 = new KissableDog("40px", "35px", "25px", "10px", "url(dog_30.png)");
    const dog31 = new KissableDog("145px", "75px", "60px", "35px", "url(dog_31.png)");
    const dog32 = new KissableDog("225px", "65px", "40px", "20px", "url(dog_32.png)");
    const dog33 = new KissableDog("170px", "60px", "45px", "15px", "url(dog_33.png)");
    const dog34 = new KissableDog("50px", "100px", "45px", "25px", "url(dog_34.png)");
    const dog35 = new KissableDog("80px", "40px", "35px", "15px", "url(dog_35.png)");
    const dog36 = new KissableDog("110px", "50px", "35px", "20px", "url(dog_36.png)");
    const dog37 = new KissableDog("200px", "130px", "35px", "20px", "url(dog_37.png)");
    const dog38 = new KissableDog("150px", "35px", "35px", "20px", "url(dog_38.png)");
    const dog39 = new KissableDog("60px", "35px", "30px", "15px", "url(dog_39.png)");
    const dog40 = new KissableDog("240px", "100px", "35px", "20px", "url(dog_40.png)");
    const dog41 = new KissableDog("160px", "95px", "35px", "20px", "url(dog_41.png)");
    const dog42 = new KissableDog("75px", "105px", "30px", "15px", "url(dog_42.png)");
    const dog43 = new KissableDog("195px", "85px", "30px", "20px", "url(dog_43.png)");
    const dog44 = new KissableDog("20px", "100px", "30px", "20px", "url(dog_44.png)");

    let kissableDogs = [dog01, dog02, dog03, dog04, dog05, dog06, dog07, dog08, dog09, dog10,
    dog11, dog12, dog13, dog14, dog15, dog16, dog17, dog18, dog19, dog20, dog21, dog22, dog23,
    dog24, dog25, dog26, dog27, dog28, dog29, dog30, dog31, dog32, dog33, dog34, dog35, dog36,
    dog37, dog38, dog39, dog40, dog41, dog42, dog43, dog44];

    // Adjusts the total amount of times you have to succesfully kiss your dog (if you kiss your dog)
    let totalDogKissRequirement = 43;

    // Lower this value to make Kisses more likely to progress to the next picture
    let kissSuccessCeiling = 125;
    
    // Toggle the Final Round of Kissing your Dog on / off
    let finalRoundActive = true;

    // Final Dog Total Required Kisses to Give
    let finalRoundKissesRequired = 100;

    // Final Dog Values
    let finalRoundStarted = false;
    let finalRoundKissesGiven = 0;
    let dogPosition = 0;
    let dogDirection = 1;
    const speed = 2; 
    const maxPosition = 210;

    // Standard Dog Values
    let kissSuccessBaseValue = 1;
    let kissSuccessChance = kissSuccessBaseValue;
    let totalSuccessfulKisses = 0;
    let currentDogIndex = 0;
    let kissMarks = [];
    let kissed = false;

    let captchaContainer  = document.getElementById("captcha-container");
    let title = document.getElementById("title");
    let kissZone = document.getElementById("captcha-kiss-zone");
    let finalRoundDog = document.getElementById("final-round-dog-kiss");


    // Loads initial dog to kiss
    loadDogToKiss(kissableDogs[currentDogIndex]);
    
    function loadDogToKiss(dog){
        setKissTitleText();
        kissZone.style.marginLeft = dog.kissZoneXCoordinate;
        kissZone.style.marginTop = dog.kissZoneYCoordinate;
        kissZone.style.width = dog.kissZoneWidth;
        kissZone.style.height = dog.kissZoneHeight;
        captchaContainer.style.backgroundImage = dog.backgroundImage;
        kissableDogs.splice(currentDogIndex, 1);
        clearDogKisses();
    }

    function clearDogKisses(){
        let timer = setTimeout(() => {
                kissMarks.forEach(element => {
                    element.remove();
            });
        }, 50);
    }
    
    function setKissTitleText(){
        if (finalRoundStarted == true){
            title.innerText = "FINAL ROUND: KISS!!!";
        }
        else  {
            title.innerText = "KISS YOUR DOG: " + totalSuccessfulKisses + "/" + totalDogKissRequirement;
        }
    }

    function getRandomInteger(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function kissTheDog(){
      let kissRNG = getRandomInteger(1, kissSuccessCeiling);

      if (kissRNG <= kissSuccessChance && kissed == false){
            kissed = true;
            kissSuccessChance = kissSuccessBaseValue;
            if (totalSuccessfulKisses < totalDogKissRequirement){
                let timer = setTimeout(() => {
                    totalSuccessfulKisses = totalSuccessfulKisses + 1;
                    setKissTitleText();
                    if (totalSuccessfulKisses > 1 && totalSuccessfulKisses < totalDogKissRequirement){
                    currentDogIndex = Math.floor(Math.random() * kissableDogs.length);
                    loadDogToKiss(kissableDogs[currentDogIndex]);
                    }
                    else if (totalSuccessfulKisses <= 1) {
                    currentDogIndex = totalSuccessfulKisses;
                    loadDogToKiss(kissableDogs[currentDogIndex]);
                    }
                    kissed = false;
            }, 1000);
            }
      }
      else {
        // If kiss fails than increase the success chance of the next kiss
        kissSuccessChance += 1;
      }
    }

    function finalKissTheDog(){
        finalRoundKissesGiven += 1;
    }

    (function(window, document){
        setCursorToLips();
        
        function setCursorToLips() {
            captchaContainer.classList.remove('custom-cursor-kiss-pucker');
            captchaContainer.classList.add('custom-cursor-kiss-mark');
        }

        function setCursorToPucker() {
            captchaContainer.classList.remove('custom-cursor-kiss-mark');
            captchaContainer.classList.add('custom-cursor-kiss-pucker');
        }

        function captchaSuccess() {
            if (finalRoundActive == true && finalRoundKissesGiven > finalRoundKissesRequired) {
                window.top.postMessage("success", '*');
            }
            
            if (totalSuccessfulKisses >= totalDogKissRequirement && finalRoundActive == false){
                window.top.postMessage("success", '*');
            }
        }
        
        function startFinalRound(){
            finalRoundStarted = true
            captchaContainer.style.backgroundImage = 'url(dog_final_round.png)';
            kissZone.style.visibility = 'hidden';
            kissZone.style.width = 0;
            kissZone.style.height = 0;
            kissZone.style.marginLeft = 0;
            kissZone.style.marginTop = 0;
            finalRoundDog.style.visibility = 'visible';
            setKissTitleText();
            window.setInterval(animateFinalDogImage, 10);
            window.setInterval(clearDogKisses, 2500);
        }

        function animateFinalDogImage() {
            dogPosition += dogDirection * speed;

            if (dogPosition >= maxPosition || dogPosition <= 0) {
                dogDirection *= -1; 
            }
            
            finalRoundDog.style.left = dogPosition + 'px';
        }

        const kissYourDog =  (event) => {
            setCursorToPucker()

            if (totalSuccessfulKisses >= totalDogKissRequirement){
                if (finalRoundActive == true && finalRoundStarted == false){
                    startFinalRound();
                }
                else {
                    captchaSuccess();
                }
            }
        
            let x = event.clientX - 25;
            let y = event.clientY - 20;
            coordinatesXString = x + "px"
            coordinatesYString = y + "px"

            const newImage = document.createElement('img');
            newImage.src = 'kiss_mark_small.png';
            newImage.style.width = '45px';
            newImage.style.position = 'absolute';
            newImage.style.marginLeft = coordinatesXString;
            newImage.style.marginTop = coordinatesYString;
            newImage.style.userSelect = "none";
            newImage.style.pointerEvents = "none";
            kissMarks.push(newImage);
            captchaContainer.appendChild(newImage);

            let timer = setTimeout(() => {
                setCursorToLips()
            }, 275);
        }
        
      document.addEventListener('click', kissYourDog)
    })(window, document);
</script>
</body>
</html>